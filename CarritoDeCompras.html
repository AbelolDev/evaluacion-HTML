<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrito de Compras</title>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/assets/css/style.css" />
  <style>
    .cart-badge {
      position: relative;
      top: -10px;
      right: 10px;
      background-color: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
    }
    .cart-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .cart-item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      margin-right: 15px;
    }
    .cart-item-details {
      flex-grow: 1;
    }
    .cart-item-price {
      font-weight: bold;
      color: #1565c0;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    .quantity-btn {
      cursor: pointer;
      background-color: #f5f5f5;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .quantity-input {
      width: 40px;
      text-align: center;
      margin: 0 10px;
      height: 30px;
    }
    .summary-card {
      position: sticky;
      top: 20px;
    }
    .empty-cart {
      text-align: center;
      padding: 40px 0;
    }
    .empty-cart i {
      font-size: 5rem;
      color: #e0e0e0;
    }
    .strike {
      text-decoration: line-through;
      color: #9e9e9e;
    }
    .discount {
      color: #e53935;
    }
  </style>
</head>
<body>
  <header class="center-align my-3">
    <h1>Carrito de Compras</h1>
  </header>

  <nav class="blue darken-3 my-5 yellow">
    <div class="nav-wrapper container">
      <!-- Imagen como logo -->
      <a href="/" class="brand-logo center-align flex">
        <img src="/assets/img/logo.png" alt="MiLogo" style="height: 50px;">
      </a>
      <!-- Icono para móvil -->
      <a href="#" data-target="mobile-demo" class="sidenav-trigger">
        <i class="material-icons">menu</i>
      </a>

      <!-- Links desktop -->
      <ul class="right hide-on-med-and-down">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="CarritoDeCompras.html">Mi carrito</a></li>
        <li><a href="/public/productos.html">Productos</a></li>
        <!--<li><a href="nosotros.html">Nosotros</a></li>-->
        <li><a href="/public/...">Nosotros</a></li>
        <li><a href="/public/registro.html">Registrar usuario</a></li>
        <li><a href="/public/iniciar.html">Iniciar sesión</a></li>
        <li><a href="/public/blogs.html">blogs</a></li>
      </ul>
    </div>
  </nav>

  <!-- Menú lateral para móvil -->
  <ul class="sidenav my-5" id="mobile-demo">
    <li><a href="index.html">Inicio</a></li>
    <li><a href="CarritoDeCompras.html">Mi carrito</a></li>
    <li><a href="/public/productos.html">Productos</a></li>
    <li><a href="/public/...">Contacto</a></li>
    <li><a href="/public/iniciar.html">Iniciar sesión</a></li>
    <li><a href="/public/registro.html">Crear usuario</a></li>
    <li><a href="/public/blogs.html">Blogs</a></li>
  </ul>

  <main class="section container my-5">
    <div class="row">
      <!-- Lista de productos en el carrito -->
      <div class="col s12 m8">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Tus Productos</span>
            
            <div id="cart-items">
              <div class="empty-cart">
                <i class="material-icons">remove_shopping_cart</i>
                <h5>Tu carrito está vacío</h5>
                <p>Agrega algunos productos desde nuestra tienda</p>
                <a href="productos.html" class="btn blue darken-3 waves-effect waves-light">
                  Ir a Productos
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-content">
            <span class="card-title">Productos Sugeridos</span>
            <div class="row">
              <div class="col s12 m6">
                <div class="card">
                  <div class="card-image">
                    <img src="assets/img/producto_4.jpg" alt="Producto 4">
                    <span class="card-title">Producto 4</span>
                  </div>
                  <div class="card-content">
                    <p>Descripción producto 4.</p>
                    <p class="cart-item-price">$19.990</p>
                  </div>
                  <div class="card-action">
                    <a href="#" class="add-to-cart" data-id="4" data-name="Producto 4" data-price="19990" data-image="assets/img/producto_4.jpg">Agregar al carrito</a>
                  </div>
                </div>
              </div>
              <div class="col s12 m6">
                <div class="card">
                  <div class="card-image">
                    <img src="assets/img/producto_5.jpg" alt="Producto 5">
                    <span class="card-title">Producto 5</span>
                  </div>
                  <div class="card-content">
                    <p>Descripción producto 5.</p>
                    <p class="cart-item-price">$24.990</p>
                  </div>
                  <div class="card-action">
                    <a href="#" class="add-to-cart" data-id="5" data-name="Producto 5" data-price="24990" data-image="assets/img/producto_5.jpg">Agregar al carrito</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Resumen del pedido -->
      <div class="col s12 m4">
        <div class="card summary-card">
          <div class="card-content">
            <span class="card-title">Resumen de compra</span>
            
            <div id="order-summary">
              <p>No hay productos en el carrito</p>
            </div>
            
            <div class="divider"></div>
            
            <div class="section">
              <div class="input-field">
                <input type="text" id="coupon" placeholder="Ingresa tu código de descuento">
                <label for="coupon">Código de descuento</label>
              </div>
              <button class="btn waves-effect waves-light blue" id="apply-coupon">Aplicar</button>
            </div>
            
            <div class="divider"></div>
            
            <div class="section">
              <h5>Total: <span id="total-amount">$0</span></h5>
              <p class="grey-text">* Envío e impuestos calculados al finalizar compra</p>
            </div>
          </div>
          <div class="card-action">
            <a href="productos.html" class="btn-flat waves-effect">Seguir comprando</a>
            <a href="#" class="btn blue darken-3 waves-effect waves-light right" id="checkout-btn">Finalizar compra</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="page-footer yellow darken-3">
    <div class="container">
      <div class="row">
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Información</h5>
          <ul>
            <li>
              <a class="grey-text text-lighten-3" href="#!"
                >Correo empresarial: contacto.empresa@email.com</a
              >
            </li>
            <li>
              <a class="grey-text text-lighten-3" href="#!"
                >Número de contacto: +56 9 5555 5555</a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">© 2025 Abel Aravena</div>
    </div>
  </footer>

  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Inicializar menú lateral
      var elems = document.querySelectorAll(".sidenav");
      M.Sidenav.init(elems);
      
      // Inicializar elementos de formulario
      M.updateTextFields();
      
      // Cargar carrito desde localStorage
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      updateCartDisplay();
      
      // Manejar clic en botones "Agregar al carrito"
      document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          const product = {
            id: this.getAttribute('data-id'),
            name: this.getAttribute('data-name'),
            price: parseInt(this.getAttribute('data-price')),
            image: this.getAttribute('data-image'),
            quantity: 1
          };
          
          addToCart(product);
        });
      });
      
      // Aplicar cupón de descuento
      document.getElementById('apply-coupon').addEventListener('click', function() {
        const couponCode = document.getElementById('coupon').value;
        if (couponCode.toUpperCase() === 'DESCUENTO10') {
          applyDiscount(10);
          M.toast({html: '¡Cupón aplicado! 10% de descuento'});
        } else {
          M.toast({html: 'Código de cupón inválido'});
        }
      });
      
      // Finalizar compra
      document.getElementById('checkout-btn').addEventListener('click', function(e) {
        e.preventDefault();
        if (cart.length === 0) {
          M.toast({html: 'Tu carrito está vacío'});
          return;
        }
        
        // Redirigir a página de pago (simulado)
        M.toast({html: 'Redirigiendo a página de pago...'});
        setTimeout(() => {
          // Aquí iría la redirección real
          console.log('Proceder al pago');
        }, 1500);
      });
      
      // Función para agregar producto al carrito
      function addToCart(product) {
        const existingItem = cart.find(item => item.id === product.id);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push(product);
        }
        
        // Guardar en localStorage
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Actualizar visualización
        updateCartDisplay();
        
        M.toast({html: `¡${product.name} agregado al carrito!`});
      }
      
      // Función para actualizar la visualización del carrito
      function updateCartDisplay() {
        const cartItemsContainer = document.getElementById('cart-items');
        const orderSummaryContainer = document.getElementById('order-summary');
        const cartCount = document.getElementById('cart-count');
        const cartCountMobile = document.getElementById('cart-count-mobile');
        const totalAmount = document.getElementById('total-amount');
        
        // Actualizar contador
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        cartCount.textContent = totalItems;
        cartCountMobile.textContent = totalItems;
        
        if (cart.length === 0) {
          cartItemsContainer.innerHTML = `
            <div class="empty-cart">
              <i class="material-icons">remove_shopping_cart</i>
              <h5>Tu carrito está vacío</h5>
              <p>Agrega algunos productos desde nuestra tienda</p>
              <a href="productos.html" class="btn blue darken-3 waves-effect waves-light">
                Ir a Productos
              </a>
            </div>
          `;
          
          orderSummaryContainer.innerHTML = `<p>No hay productos en el carrito</p>`;
          totalAmount.textContent = '$0';
          return;
        }
        
        // Calcular totales
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        const discount = window.cartDiscount || 0;
        const discountAmount = discount > 0 ? (subtotal * discount / 100) : 0;
        const total = subtotal - discountAmount;
        
        // Mostrar items del carrito
        cartItemsContainer.innerHTML = '';
        cart.forEach(item => {
          const itemTotal = item.price * item.quantity;
          cartItemsContainer.innerHTML += `
            <div class="cart-item" data-id="${item.id}">
              <img src="${item.image}" alt="${item.name}" class="cart-item-image">
              <div class="cart-item-details">
                <h6>${item.name}</h6>
                <p class="cart-item-price">$${formatPrice(item.price)}</p>
                <div class="quantity-controls">
                  <button class="quantity-btn decrease-quantity"><i class="material-icons">remove</i></button>
                  <input type="number" value="${item.quantity}" min="1" class="quantity-input" readonly>
                  <button class="quantity-btn increase-quantity"><i class="material-icons">add</i></button>
                  <button class="btn-flat red-text remove-item"><i class="material-icons">delete</i></button>
                </div>
              </div>
              <div class="cart-item-total">
                <strong>$${formatPrice(itemTotal)}</strong>
              </div>
            </div>
          `;
        });
        
        // Mostrar resumen de orden
        orderSummaryContainer.innerHTML = '';
        cart.forEach(item => {
          const itemTotal = item.price * item.quantity;
          orderSummaryContainer.innerHTML += `
            <p>${item.name} x${item.quantity} <span class="right">$${formatPrice(itemTotal)}</span></p>
          `;
        });
        
        orderSummaryContainer.innerHTML += `<div class="divider"></div>`;
        
        if (discount > 0) {
          orderSummaryContainer.innerHTML += `
            <p>Subtotal <span class="right">$${formatPrice(subtotal)}</span></p>
            <p class="discount">Descuento (${discount}%) <span class="right">-$${formatPrice(discountAmount)}</span></p>
          `;
        }
        
        // Actualizar total
        totalAmount.textContent = `$${formatPrice(total)}`;
        
        // Agregar event listeners a los botones de cantidad
        document.querySelectorAll('.increase-quantity').forEach(button => {
          button.addEventListener('click', function() {
            const itemElement = this.closest('.cart-item');
            const itemId = itemElement.getAttribute('data-id');
            increaseQuantity(itemId);
          });
        });
        
        document.querySelectorAll('.decrease-quantity').forEach(button => {
          button.addEventListener('click', function() {
            const itemElement = this.closest('.cart-item');
            const itemId = itemElement.getAttribute('data-id');
            decreaseQuantity(itemId);
          });
        });
        
        document.querySelectorAll('.remove-item').forEach(button => {
          button.addEventListener('click', function() {
            const itemElement = this.closest('.cart-item');
            const itemId = itemElement.getAttribute('data-id');
            removeFromCart(itemId);
          });
        });
      }
      
      // Función para aumentar cantidad
      function increaseQuantity(itemId) {
        const item = cart.find(item => item.id === itemId);
        if (item) {
          item.quantity += 1;
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartDisplay();
        }
      }
      
      // Función para disminuir cantidad
      function decreaseQuantity(itemId) {
        const item = cart.find(item => item.id === itemId);
        if (item && item.quantity > 1) {
          item.quantity -= 1;
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartDisplay();
        }
      }
      
      // Función para eliminar producto del carrito
      function removeFromCart(itemId) {
        cart = cart.filter(item => item.id !== itemId);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartDisplay();
        M.toast({html: 'Producto eliminado del carrito'});
      }
      
      // Función para aplicar descuento
      function applyDiscount(percent) {
        window.cartDiscount = percent;
        updateCartDisplay();
      }
      
      // Función para formatear precios
      function formatPrice(price) {
        return (price / 100).toFixed(3);
      }
    });
  </script>
</body>
</html>